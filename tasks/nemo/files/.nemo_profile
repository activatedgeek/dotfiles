export NEMORUN_HOME=${STORE_HOME}/.nemo_run

export NEMO_SKILLS_DISABLE_UNCOMMITTED_CHANGES_CHECK=1
export NEMO_SKILLS_CONFIG_DIR=${HOME}/.config/nemo_skills/cluster_configs

function nrlogd {
    if [[ -z "${1}" ]]; then
        echo "[ERROR]: Missing Slurm Job ID."
        echo "Usage:"
        echo "  nrlogd SLURM_JOB_ID"
        return 1
    fi
    sacct --json -P -o state -j ${1} | jq -r '.jobs[0] | .submit_line' | rev | cut -d' ' -f1 | rev | xargs cat | grep -m1 '\-\-output' | cut -d= -f2 | xargs dirname
}

function nrtail {
    if [[ -z "${1}" ]]; then
        echo "[ERROR]: Missing Slurm Job ID."
        echo "Usage:"
        echo "  nrtail SLURM_JOB_ID [main|server|sandbox|...]"
        return 1
    fi
    nrlogd ${1} | __slurm_job_id=${1} __log_name=${2:-main} xargs -I{} bash -c 'tail -n 500 -f {}/*${__log_name}*${__slurm_job_id}*.log'
}

function nrless {
    if [[ -z "${1}" ]]; then
        echo "[ERROR]: Missing Slurm Job ID."
        echo "Usage:"
        echo "  nrless SLURM_JOB_ID [main|server|sandbox|...]"
        return 1
    fi
    nrlogd ${1} | __slurm_job_id=${1} __log_name=${2:-main} xargs -I{} bash -c 'less {}/*${__log_name}*${__slurm_job_id}*.log'
}

alias nrinfo='uvr nemo experiment status'
