ssh_tunnel:
  host: {{ ssh_tunnel_host }}
  port: {{ ssh_tunnel_port }}
  user: {{ ssh_user }}
  job_dir: /home/{{ ssh_user }}/store/.nemo_run
  pre_command: HEADLESS=1 source ~/.bash_profile

executor: slurm
{% if disable_gpus_per_node is defined and disable_gpus_per_node %}
disable_gpus_per_node: {{ disable_gpus_per_node }}
{% endif %}
account: {{ sbatch_account }}
mail_type: FAIL
partition: {{ sbatch_partition }}
{% if disable_cpu_partition is not defined or not disable_cpu_partition %}
cpu_partition: {{ sbatch_cpu_partition }}
{% endif %}
timeouts:
  {{ sbatch_partition }}: 04:00:00
  interactive: 04:00:00
  interactive_singlenode: 04:00:00
  cpu: 04:00:00

containers:
  nemo-rl: /home/{{ ssh_user }}/store/images/nemo-skills/nemo-skills-nemo-rl-latest.sqsh
  nemo-skills: /home/{{ ssh_user }}/store/images/nemo-skills/nemo-skills-latest.sqsh
  sandbox: /home/{{ ssh_user }}/store/images/nemo-skills/nemo-skills-sandbox-latest.sqsh
  sglang: /home/{{ ssh_user }}/store/images/nemo-skills/nemo-skills-sglang-latest.sqsh
  vllm: /home/{{ ssh_user }}/store/images/{{ vllm_version | d("nemo-skills/nemo-skills-vllm-latest")  }}.sqsh

mounts:
  - /home/{{ ssh_user }}/store:/store

env_vars:
  - XDG_CACHE_HOME=/store/.cache
  - HF_HOME=/store/.cache/huggingface
